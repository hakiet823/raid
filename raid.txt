#!/bin/bash

# Install required tools
sudo apt update
sudo apt install -y scsitools
sudo apt install -y mdadm

# Rescan the SCSI bus to detect new devices
sudo rescan-scsi-bus

# List block devices
lsblk -o NAME,SIZE,FSTYPE,TYPE,MOUNTPOINT

# Create a RAID 0 array with two devices
sudo mdadm --create --verbose /dev/md0 --level=0 --raid-devices=2 /dev/sdb /dev/sdc

# Format the RAID array with ext4 filesystem
sudo mkfs.ext4 -F /dev/md0

# Create mount directory
sudo mkdir -p /mnt/md0

# Mount the RAID array
sudo mount /dev/md0 /mnt/md0

# Save the RAID configuration to mdadm.conf
sudo mdadm --detail --scan | sudo tee -a /etc/mdadm/mdadm.conf

# Update initramfs to include the RAID configuration
sudo update-initramfs -u

# Add RAID mount to fstab for persistent mounting
echo '/dev/md0 /mnt/md0 ext4 defaults,nofail,discard 0 0' | sudo tee -a /etc/fstab

# Display RAID details
sudo mdadm --detail /dev/md0